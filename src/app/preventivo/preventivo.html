<div class="page-container">

    <!-- **************  LISTA  ************** -->
    <!-- ************************************* -->
    @if (pageMode() === 'list') {
    <!-- Header + Search + Button -->
    <div class="header-row">
        <h2 class="page-title">Elenco Preventivi</h2>

        <div class="actions">
            <input type="text" class="search" placeholder="Cerca cliente..."
                (input)="searchTerm.set($any($event.target).value)" />

            <button class="btn-primary" (click)="nuovoPreventivo()">
                <i class="fal fa-plus"></i> Nuovo Preventivo
            </button>
        </div>
    </div>

    <!-- Tabella -->
    <div class="table-card">
        <table class="styled-table">

            <thead>
                <tr>
                    <th (click)="changeSort('id')">ID</th>
                    <th (click)="changeSort('nomeCliente')">Cliente</th>
                    <th (click)="changeSort('dataPreventivo')">Data</th>
                    <th (click)="changeSort('importoTotale')">Importo (â‚¬)</th>
                </tr>
            </thead>

            <tbody>
                @for (p of paginated(); track p.id) {
                <tr (click)="openDetails(p)">
                    <td>{{ p.id }}</td>
                    <td>{{ p.nomeCliente }}</td>
                    <td>{{ p.dataPreventivo }}</td>
                    <td>{{ p.importoTotale | number:'1.2-2' }}</td>
                </tr>
                }
            </tbody>

        </table>
    </div>

    <!-- Paginazione -->
    <div class="pagination">
        <button (click)="goToPage(currentPage()-1)" [disabled]="currentPage() === 1">
            <i class="fal fa-chevron-left"></i>
        </button>

        <span>Pagina {{ currentPage() }} di {{ totalPages() }}</span>

        <button (click)="goToPage(currentPage()+1)" [disabled]="currentPage() === totalPages()">
            <i class="fal fa-chevron-right"></i>
        </button>
    </div>
    }

    <!-- ****** DETTAGLIO / EDIT INLINE ****** -->
    <!-- ************************************* -->


    <!-- contenitore dettaglio con classe slide-in -->
    @if (pageMode() === 'detail' && selectedPreventivo()) {
    <div class="table-card" [formGroup]="formPreventivo">
        <button class="btn-primary" (click)="backToList()">
            <i class="fal fa-arrow-left"></i> Torna alla lista
        </button>
        @if (!isEditing()) {
        <h2>Dettaglio Preventivo</h2>
        }
        @if (isEditing()) {
        <h2>Modifica Preventivo</h2>
        }
        <div class="detail-row">
            <label for="id">ID</label>
            <input id="id" type="text" formControlName="id" />
        </div>

        <div class="detail-row">
            <label for="nomeCliente">Cliente</label>
            <input id="nomeCliente" type="text" formControlName="nomeCliente" />
        </div>

        <div class="detail-row">
            <label for="dataPreventivo">Data</label>
            <input id="dataPreventivo" type="date" formControlName="dataPreventivo" />
        </div>

        <div class="detail-row">
            <label for="importoTotale">Importo</label>
            <input id="importoTotale" type="number" formControlName="importoTotale" />
        </div>

        <div class="modal-actions" style="margin-top: 2rem;">
            <!-- EDIT MODE OFF -->
            @if (!isEditing()) {
            <button class="icon-btn print" (click)="printPreventivo(selectedPreventivo()!)">
                <i class="fal fa-print"></i>
            </button>

            <button class="icon-btn edit" (click)="editPreventivo()">
                <i class="fal fa-pencil"></i>
            </button>

            <button class="icon-btn delete" (click)="deletePreventivo(selectedPreventivo()!)">
                <i class="fal fa-trash"></i>
            </button>
            }

            <!-- EDIT MODE ON -->
            @if (isEditing()) {
            <button class="icon-btn edit" (click)="savePreventivo()">
                <i class="fal fa-save"></i>
            </button>

            <button class="icon-btn close" (click)="cancelEdit()">
                <i class="fal fa-times"></i>
            </button>
            }
        </div>
    </div>
    }

</div>