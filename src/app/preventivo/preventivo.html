<div class="page-container">

    <!-- **************  LISTA  ************** -->
    <!-- ************************************* -->
    @if (pageMode() === 'list') {
    <!-- Header + Search + Button -->
    <div class="header-row">
        <h2 class="page-title">Elenco Preventivi</h2>

        <div class="actions">
            <input type="text" class="search" placeholder="Cerca cliente..."
                (input)="searchTerm.set($any($event.target).value)" />

            <button class="btn-primary" (click)="nuovoPreventivo()">
                <i class="fal fa-plus"></i> Nuovo Preventivo
            </button>
        </div>
    </div>

    <!-- Tabella -->
    <div class="table-card">
        <table class="styled-table">

            <thead>
                <tr>
                    <th (click)="changeSort('id')">ID</th>
                    <th (click)="changeSort('nomeCliente')">Cliente</th>
                    <th (click)="changeSort('dataPreventivo')">Data</th>
                    <th (click)="changeSort('importoTotale')">Importo (€)</th>
                </tr>
            </thead>

            <tbody>
                @for (p of paginated(); track p.id) {
                <tr (click)="openDetails(p)">
                    <td>{{ p.id }}</td>
                    <td>{{ p.nomeCliente }}</td>
                    <td>{{ p.dataPreventivo }}</td>
                    <td>{{ p.importoTotale | number:'1.2-2' }}</td>
                </tr>
                }
            </tbody>

        </table>
    </div>

    <!-- Paginazione -->
    <div class="pagination">
        <button (click)="goToPage(currentPage()-1)" [disabled]="currentPage() === 1">
            <i class="fal fa-chevron-left"></i>
        </button>

        <span>Pagina {{ currentPage() }} di {{ totalPages() }}</span>

        <button (click)="goToPage(currentPage()+1)" [disabled]="currentPage() === totalPages()">
            <i class="fal fa-chevron-right"></i>
        </button>
    </div>
    }

    <!-- ****** DETTAGLIO / EDIT INLINE ****** -->
    <!-- ************************************* -->
    @if (pageMode() === 'detail' && selectedPreventivo()) {

    <button class="btn-primary" (click)="backToList()">
        <i class="fal fa-arrow-left"></i> Torna alla lista
    </button>

    <div class="table-card">
        <h2>Dettaglio Preventivo</h2>

        <div class="detail-row">
            <span>ID</span>
            <strong>{{ selectedPreventivo()?.id }}</strong>
        </div>

        <div class="detail-row">
            <span>Cliente</span>
            <strong>{{ selectedPreventivo()?.nomeCliente }}</strong>
        </div>

        <div class="detail-row">
            <span>Data</span>
            <strong>{{ selectedPreventivo()?.dataPreventivo }}</strong>
        </div>

        <div class="detail-row">
            <span>Importo</span>
            <strong>{{ selectedPreventivo()?.importoTotale | number:'1.2-2' }} €</strong>
        </div>

        <div class="modal-actions" style="margin-top: 2rem;">
            <button class="icon-btn print" (click)="printPreventivo(selectedPreventivo()!)">
                <i class="fal fa-print"></i>
            </button>

            <button class="icon-btn edit" (click)="editPreventivo(selectedPreventivo()!)">
                <i class="fal fa-pencil"></i>
            </button>

            <button class="icon-btn delete" (click)="deletePreventivo(selectedPreventivo()!)">
                <i class="fal fa-trash"></i>
            </button>
        </div>

    </div>
    }
</div>