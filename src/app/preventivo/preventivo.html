<div class="page-container">

    <!-- Header + Search + Button -->
    <div class="header-row">
        <h2 class="page-title">Elenco Preventivi</h2>

        <div class="actions">
            <input type="text" class="search" placeholder="Cerca cliente..."
                (input)="searchTerm.set($any($event.target).value)" />

            <button class="btn-primary" (click)="nuovoPreventivo()">
                <i class="fal fa-plus"></i> Nuovo Preventivo
            </button>
        </div>
    </div>

    <!-- Tabella -->
    <div class="table-card">
        <table class="styled-table">

            <thead>
                <tr>
                    <th (click)="changeSort('id')">ID</th>
                    <th (click)="changeSort('nomeCliente')">Cliente</th>
                    <th (click)="changeSort('dataPreventivo')">Data</th>
                    <th (click)="changeSort('importoTotale')">Importo (€)</th>
                </tr>
            </thead>

            <tbody>
                @for (p of paginated(); track p.id) {
                <tr (click)="openDetails(p)">
                    <td>{{ p.id }}</td>
                    <td>{{ p.nomeCliente }}</td>
                    <td>{{ p.dataPreventivo }}</td>
                    <td>{{ p.importoTotale | number:'1.2-2' }}</td>
                </tr>
                }
            </tbody>

        </table>
    </div>

    <!-- Paginazione -->
    <div class="pagination">
        <button (click)="goToPage(currentPage()-1)" [disabled]="currentPage() === 1">
            <i class="fal fa-chevron-left"></i>
        </button>

        <span>Pagina {{ currentPage() }} di {{ totalPages() }}</span>

        <button (click)="goToPage(currentPage()+1)" [disabled]="currentPage() === totalPages()">
            <i class="fal fa-chevron-right"></i>
        </button>
    </div>

    <!-- Modale Dettaglio -->
    @if (showDetails()) {
    <div class="modal-overlay" (click)="closeDetails()"></div>

    <div class="modal-card">
        <div class="modal-header">
            <h3>Dettaglio Preventivo</h3>

            <div class="modal-actions">
                <button class="icon-btn print" (click)="printPreventivo(selectedPreventivo()!)">
                    <i class="fal fa-print"></i>
                </button>

                <button class="icon-btn edit" (click)="editPreventivo(selectedPreventivo()!)">
                    <i class="fal fa-pencil"></i>
                </button>

                <button class="icon-btn delete" (click)="deletePreventivo(selectedPreventivo()!)">
                    <i class="fal fa-trash"></i>
                </button>

                <button class="icon-btn close" (click)="closeDetails()">
                    <i class="fal fa-times"></i>
                </button>
            </div>
        </div>

        <div class="detail-row">
            <span>ID</span>
            <strong>{{ selectedPreventivo()?.id }}</strong>
        </div>

        <div class="detail-row">
            <span>Cliente</span>
            <strong>{{ selectedPreventivo()?.nomeCliente }}</strong>
        </div>

        <div class="detail-row">
            <span>Data</span>
            <strong>{{ selectedPreventivo()?.dataPreventivo }}</strong>
        </div>

        <div class="detail-row">
            <span>Importo</span>
            <strong>{{ selectedPreventivo()?.importoTotale | number:'1.2-2' }} €</strong>
        </div>
    </div>
    }
</div>